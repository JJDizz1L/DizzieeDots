#!/usr/bin/env bash
# /home/dizziee/.config/hypr/fzfpurge

# ──────────────────────────────────────────────────────────────
#  Interactive pacman package purge helper
# ──────────────────────────────────────────────────────────────
purger() {
    echo "Gathering installed packages..."
    local pkg

    pkg=$(pacman -Qq | fzf --prompt="Select a package to inspect/remove: " \
        --preview '
            echo "Package: {}"
            echo "-------------------"
            echo "Dependencies:"
            pactree -d1 {} || echo "  (none)"
            echo
            echo "Reverse dependencies:"
            pactree -r -d1 {} || echo "  (none)"
            echo
            echo "Removable with:"
            echo "  sudo pacman -Rns {}"
        ')

    # If user pressed ESC or no package was chosen
    [[ -z "$pkg" ]] && { echo "No package selected."; return; }

    echo "You selected: $pkg"
    echo
    echo "Dependencies:"
    pactree -d1 "$pkg" || echo "  (none)"
    echo
    echo "Reverse dependencies:"
    pactree -r -d1 "$pkg" || echo "  (none)"
    echo

    read -rp "Do you want to remove $pkg (and its unused deps)? [y/N]: " confirm
    if [[ "$confirm" =~ ^[Yy]$ ]]; then
        sudo pacman -Rns "$pkg"
        echo "$pkg removed successfully!"
    else
        echo "Aborted."
    fi
}

# Call the function so that running the file actually does something
purger
